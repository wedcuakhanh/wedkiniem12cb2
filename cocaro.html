<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>C·ªù Caro Tu·ªïi H·ªçc Tr√≤</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      font-family: 'Quicksand', sans-serif;
    }
    body {
      margin: 0;
      background-color: #ffe6f0;
      text-align: center;
    }
    h1 {
      color: #d63384;
      margin-top: 20px;
      text-shadow: 1px 1px 3px #fff;
    }
    .controls, .status, .theme-select, .ranking {
      margin: 10px auto;
    }
    .btn {
      background: linear-gradient(45deg, #ff85a2, #ffc2e2);
      border: none;
      padding: 10px 20px;
      margin: 5px;
      border-radius: 12px;
      font-weight: bold;
      color: white;
      cursor: pointer;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: 0.3s;
    }
    .btn:hover {
      background: linear-gradient(45deg, #ff639a, #ffaad1);
      transform: scale(1.05);
    }
    .board {
      display: grid;
      grid-template-columns: repeat(20, 30px);
      justify-content: center;
      margin: 20px auto;
    }
    .cell {
      width: 30px;
      height: 30px;
      border: 1px solid #fff;
      background-color: #ffe6f0;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.2s;
    }
    .cell:hover {
      background-color: #ffc2e2;
    }
    .win {
      background-color: yellow !important;
      animation: glow 0.8s infinite alternate;
    }
    @keyframes glow {
      from { box-shadow: 0 0 5px #ff69b4; }
      to { box-shadow: 0 0 20px #ff69b4; }
    }
    .ranking, .clock {
      color: #c2185b;
      font-weight: bold;
    }
    canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 999;
    }
       .navbar a {
        padding: 10px 18px;
        background: linear-gradient(45deg, #ff6ec4, #7873f5);
        color: white;
        font-weight: bold;
        border-radius: 30px;
        text-decoration: none;
        transition: all 0.3s ease;
        box-shadow: 0 4px 10px rgba(255, 105, 180, 0.4);
      }
  </style>
</head>
<body>
  <h1>üéì C·ªù Caro Tu·ªïi H·ªçc Tr√≤ üéì</h1>
  <div class="controls">
    <input type="text" id="player1" placeholder="T√™n Ng∆∞·ªùi ch∆°i 1">
    <input type="text" id="player2" placeholder="T√™n Ng∆∞·ªùi ch∆°i 2 / M√°y">
    <button class="btn" onclick="startGame('human')">üë´ Ng∆∞·ªùi - Ng∆∞·ªùi</button>
    <button class="btn" onclick="startGame('bot')">ü§ñ Ng∆∞·ªùi - M√°y</button>
    <button class="btn" onclick="resetRanking()">üóëÔ∏è Reset B·∫£ng</button>
  </div>
  <div class="navbar">
      <a href="trangchu.html">üè† Trang ch·ªß</a>
  <div class="theme-select">
    <label for="theme">üé® Ch·ªß ƒë·ªÅ:</label>
    <select id="theme" onchange="changeTheme()">
      <option value="#ffe6f0">H·ªìng</option>
      <option value="#e0f7fa">Xanh ng·ªçc</option>
      <option value="#f3e5f5">T√≠m nh·∫°t</option>
      <option value="#fff3e0">Cam nh·∫°t</option>
    </select>
  </div>
  <div class="status"></div>
  <div class="clock">‚è≥ L∆∞·ª£t: <span id="timer">20</span>s</div>
  <div class="board" id="board"></div>
  <div class="ranking">
    <h3>üèÜ B·∫£ng X·∫øp H·∫°ng</h3>
    <ul id="rankList"></ul>
  </div>
  <canvas id="fireworks"></canvas>
  <audio id="winSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_6652a4f7c8.mp3" preload="auto"></audio>
  <audio autoplay loop>
    <source src="https://cdn.pixabay.com/download/audio/2022/11/03/audio_d58e89cdb0.mp3" type="audio/mpeg">
  </audio>
  <script>
    const board = document.getElementById('board');
    const statusDiv = document.querySelector('.status');
    const rankList = document.getElementById('rankList');
    const timerSpan = document.getElementById('timer');
    const winSound = document.getElementById('winSound');
    const fireworks = document.getElementById('fireworks');
    const ctx = fireworks.getContext('2d');
    let cells = [], player1 = '', player2 = '', current = 'X', mode = 'human';
    let winner = null, timer, countdown = 20;
    let score = {}; // name: win count

    function initBoard() {
      board.innerHTML = '';
      cells = [];
      for (let i = 0; i < 20; i++) {
        cells[i] = [];
        for (let j = 0; j < 20; j++) {
          const cell = document.createElement('div');
          cell.classList.add('cell');
          cell.dataset.row = i;
          cell.dataset.col = j;
          cell.addEventListener('click', handleMove);
          board.appendChild(cell);
          cells[i][j] = '';
        }
      }
    }

    function startGame(selectedMode) {
      player1 = document.getElementById('player1').value || 'B·∫°n 1';
      player2 = document.getElementById('player2').value || (selectedMode === 'bot' ? 'M√°y' : 'B·∫°n 2');
      current = 'X';
      mode = selectedMode;
      winner = null;
      countdown = 20;
      timerSpan.textContent = countdown;
      clearInterval(timer);
      timer = setInterval(countDown, 1000);
      initBoard();
      updateStatus();
    }

    function handleMove(e) {
      if (winner) return;
      const row = +e.target.dataset.row;
      const col = +e.target.dataset.col;
      if (cells[row][col]) return;
      cells[row][col] = current;
      e.target.textContent = current;
      checkWin(row, col);
      if (winner) {
        clearInterval(timer);
        winSound.play();
        launchFireworks();
        updateRanking();
        return;
      }
      current = current === 'X' ? 'O' : 'X';
      updateStatus();
      countdown = 20;
      if (mode === 'bot' && current === 'O') {
        setTimeout(botMove, 300);
      }
    }

    function botMove() {
      for (let i = 0; i < 20; i++) {
        for (let j = 0; j < 20; j++) {
          if (!cells[i][j]) {
            cells[i][j] = 'O';
            document.querySelector(`.cell[data-row='${i}'][data-col='${j}']`).textContent = 'O';
            checkWin(i, j);
            current = 'X';
            countdown = 20;
            updateStatus();
            return;
          }
        }
      }
    }

    function checkWin(row, col) {
      const directions = [[0,1],[1,0],[1,1],[1,-1]];
      for (const [dx,dy] of directions) {
        let count = 1, winCells = [[row,col]];
        for (let d = -1; d <= 1; d += 2) {
          let r = row + dx*d, c = col + dy*d;
          while (cells[r]?.[c] === current) {
            count++; winCells.push([r,c]);
            r += dx*d; c += dy*d;
          }
        }
        if (count >= 5) {
          winner = current;
          for (const [r,c] of winCells) {
            document.querySelector(`.cell[data-row='${r}'][data-col='${c}']`).classList.add('win');
          }
          alert(`${current === 'X' ? player1 : player2} th·∫Øng üéâ`);
          break;
        }
      }
    }

    function updateStatus() {
      statusDiv.textContent = `L∆∞·ª£t: ${current === 'X' ? player1 : player2}`;
    }

    function updateRanking() {
      const winnerName = current === 'X' ? player1 : player2;
      score[winnerName] = (score[winnerName] || 0) + 1;
      rankList.innerHTML = Object.entries(score)
        .sort((a,b) => b[1] - a[1])
        .map(([name, s]) => `<li>${name}: ${s} th·∫Øng</li>`)
        .join('');
    }

    function resetRanking() {
      score = {};
      rankList.innerHTML = '';
    }

    function goHome() {
      location.reload();
    }

    function changeTheme() {
      document.body.style.backgroundColor = document.getElementById('theme').value;
    }

    function countDown() {
      if (--countdown <= 0) {
        clearInterval(timer);
        alert(`${current === 'X' ? player1 : player2} h·∫øt gi·ªù üòÖ`);
        current = current === 'X' ? 'O' : 'X';
        countdown = 20;
        timer = setInterval(countDown, 1000);
      }
      timerSpan.textContent = countdown;
    }

    function launchFireworks() {
      ctx.clearRect(0, 0, fireworks.width, fireworks.height);
      for (let i = 0; i < 100; i++) {
        const x = Math.random() * fireworks.width;
        const y = Math.random() * fireworks.height;
        ctx.fillStyle = `hsl(${Math.random()*360}, 100%, 70%)`;
        ctx.beginPath();
        ctx.arc(x, y, 3 + Math.random() * 3, 0, Math.PI*2);
        ctx.fill();
      }
      setTimeout(() => ctx.clearRect(0, 0, fireworks.width, fireworks.height), 2000);
    }

    fireworks.width = window.innerWidth;
    fireworks.height = window.innerHeight;
    initBoard();
  </script>
</body>
</html>
